<!DOCTYPE html>
<html lang="en-us">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>lubridate month() &#43; wday()</title>
<meta name="description" content="R notes to myself">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="all,follow">
<meta name="googlebot" content="index,follow,snippet,archive">
<link rel="stylesheet" href="/css/bootstrap.min.css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400,300,700,400italic">
<link rel="stylesheet" href="/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/owl.carousel.css">
<link rel="stylesheet" href="/css/owl.theme.css">


  <link href="/css/style.default.css" rel="stylesheet" id="theme-stylesheet">

 

  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  


<link href="/css/custom.css" rel="stylesheet">
<link rel="shortcut icon" href="/img/favicon.png">


</head>
<body>
  <div id="all">
      <div class="container-fluid">
          <div class="row row-offcanvas row-offcanvas-left">
              <div id="sidebar" class="col-xs-6 col-sm-4 col-md-3 sidebar-offcanvas">
  <div class="sidebar-content">
    <h1 class="sidebar-heading"><a href="/">R notes to myself</a></h1>
    
      <p class="sidebar-p">I am an academic @ UNSW Sydney, mother, and juggler. Learning new things and writing about it. Thoughts probably not suitable for public consumption.</p>
    
    <ul class="sidebar-menu">
      
      
        <li><a href="/about/">About</a></li>
      
        <li><a href="/post/">Blog</a></li>
      
        <li><a href="/projects/">Projects</a></li>
      
        <li><a href="/contact/">Get in touch</a></li>
      
    </ul>
    <p class="social">
  
  
  
  <a href="https://twitter.com/JenRichmondPhD" data-animate-hover="pulse" class="external twitter">
    <i class="fa fa-twitter"></i>
  </a>
  
  
  
  <a href="mailto:jrichmond@psy.unsw.edu.au" data-animate-hover="pulse" class="email">
    <i class="fa fa-envelope"></i>
  </a>
  
  
  
  
  <a href="https://github.com/jenrichmond" data-animate-hover="pulse" class="external">
    <i class="fa fa-github"></i>
  </a>
  
  
</p>


    <div class="copyright">
      <p class="credit">
        
          &copy;2018 Jenny Richmond PhD
        
        | Template by <a href="https://bootstrapious.com/free-templates" class="external">Bootstrapious.com</a>

&amp; ported to Hugo by <a href="https://github.com/kishaningithub">Kishan B</a>

      </p>
    </div>
  </div>
</div>

              
<div class="col-xs-12 col-sm-8 col-md-9 content-column white-background">
  <div class="small-navbar visible-xs">
  <button type="button" data-toggle="offcanvas" class="btn btn-ghost pull-left"> <i class="fa fa-align-left"> </i>Menu</button>
  <h1 class="small-navbar-heading"><a href="/">R notes to myself</a></h1>
</div>

  <div class="row">
    <div class="col-lg-8">
      <div class="content-column-content">
         <h1>lubridate month() &#43; wday()</h1>
         


<blockquote>
<p>Art by Allison Horst <span class="citation">@allison_horst</span></p>
</blockquote>
<p>When I am trying to work out a problem with R, I generally skip the package documentation, I avoid stack overflow, and I go straight for a blog post written by someone who has just learned what I am trying to learn.</p>
<p>I think when you have just learned something, you are in THE BEST PLACE to teach someone else. You are acutely aware of what it feels like to not “get it”. You have only very recently worked out the pinch points and stumbling blocks, so you are well positioned to write in a way that allows another beginner to avoid all that.</p>
<p>In contrast, package documentation is written by the developer who knows WAY TOO MUCH about the intricacies of how it works under the hood to have much empathy for someone who knows nothing. And stack overflow is full of experts who suffer from the curse of knowledge and deliver base R solutions in a condescending tone.</p>
<div class="figure">
<img src="https://miro.medium.com/max/1000/0*qC0M4JWVSUDmotjJ.jpg" alt="" />
<p class="caption">the curse of knowledge</p>
</div>
<p>When I found <a href="https://juliasilge.com/blog/lubridate-london-stage/">Julia’s Silge’s post about lubridate</a> I was immediately excited because I knew that I could learn A LOT about how lubridate works by finding an interesting dataset and emulating her post.</p>
<p>COVID cases have been really low in NSW in the last couple of weeks after a bit of a spike back in July-August, but the Chief Health Officer has been warning about not becoming complacent because testing rates have also been declining.</p>
<p><a href="https://data.nsw.gov.au/nsw-covid-19-data/tests">This data</a> comes from NSW health and contains the number of tests conducted throughout NSW each day by age group during the pandemic. There should be date data to deal with.</p>
<div id="load-packages" class="section level1">
<h1>load packages</h1>
<pre class="r"><code>library(tidyverse)
library(here)
library(ggeasy) # for easy ggplot editing
library(harrypotter) # for palettes
options(scipen = 999)</code></pre>
<pre class="r"><code>library(lubridate)</code></pre>
<pre><code>## 
## Attaching package: &#39;lubridate&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:here&#39;:
## 
##     here</code></pre>
<pre><code>## The following object is masked from &#39;package:base&#39;:
## 
##     date</code></pre>
<p>I usually ask .Rmd to not even show me these package loading messages by setting the chunk options to <code>warning = FALSE, messages = FALSE</code>, but this warning could be the source of some issues I have had with lubridate in the past.</p>
<p>The lubridate package has a <code>here()</code> function that messes with the <code>here()</code> function from the <code>here</code> package. If you are going to use <code>lubridate</code> and <code>here</code> in the same analysis, you need to remember to use <code>here::here()</code> to avoid problems.</p>
<blockquote class="twitter-tweet">
<p lang="en" dir="ltr">
literally no chill tonight. or ever, really. <a href="https://t.co/UqnfPtcTl4">pic.twitter.com/UqnfPtcTl4</a>
</p>
— Jesse Mostipak (<span class="citation">@kierisi</span>) <a href="https://twitter.com/kierisi/status/1245532577932414976?ref_src=twsrc%5Etfw">April 2, 2020</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<blockquote>
<p>apparently the next version of lubridate won’t have a here() function, when is that coming out?</p>
</blockquote>
</div>
<div id="read-in-the-data" class="section level1">
<h1>read in the data</h1>
<pre class="r"><code>tests &lt;- read_csv(&quot;testing_agg.csv&quot;)</code></pre>
</div>
<div id="check-data-types" class="section level1">
<h1>check data types</h1>
<pre class="r"><code>glimpse(tests)</code></pre>
<pre><code>## Rows: 1,635
## Columns: 3
## $ test_date  &lt;date&gt; 2020-03-09, 2020-03-09, 2020-03-09, 2020-03-09, 2020…
## $ age_group  &lt;chr&gt; &quot;AgeGroup_0-9&quot;, &quot;AgeGroup_10-19&quot;, &quot;AgeGroup_20-29&quot;, &quot;…
## $ test_count &lt;dbl&gt; 238, 386, 688, 779, 621, 582, 344, 261, 207, 383, 803…</code></pre>
<p>Nice! the date column is in date format, that doesn’t always happen with my data in the wild.</p>
<blockquote>
<p>why does R sometimes auto-recognise dates and other times not?</p>
</blockquote>
<p>Lets look at the first few rows of the dataframe. Looks like we have test counts each day for separate age groups. I’m not interested in age at the moment, but I would like to know how testing rates have changed over the past few months.</p>
<pre class="r"><code>head(tests)</code></pre>
<pre><code>## # A tibble: 6 x 3
##   test_date  age_group      test_count
##   &lt;date&gt;     &lt;chr&gt;               &lt;dbl&gt;
## 1 2020-03-09 AgeGroup_0-9          238
## 2 2020-03-09 AgeGroup_10-19        386
## 3 2020-03-09 AgeGroup_20-29        688
## 4 2020-03-09 AgeGroup_30-39        779
## 5 2020-03-09 AgeGroup_40-49        621
## 6 2020-03-09 AgeGroup_50-59        582</code></pre>
<p>Start by making a dataframe with getting the total tests conducted each day across age groups.</p>
<pre class="r"><code>total_tests &lt;- tests %&gt;% 
  group_by(test_date) %&gt;%
  summarise(test_count = sum(test_count))</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
</div>
<div id="getting-monthsdays" class="section level1">
<h1>getting months/days</h1>
<p>lubridate has functions that will pull the day, month or year from a variable in date format. Following in Julia’s footsteps here.</p>
<pre class="r"><code>today() </code></pre>
<pre><code>## [1] &quot;2020-10-22&quot;</code></pre>
<pre class="r"><code>year(today())</code></pre>
<pre><code>## [1] 2020</code></pre>
<pre class="r"><code>month(today())</code></pre>
<pre><code>## [1] 10</code></pre>
<pre class="r"><code>day(today())</code></pre>
<pre><code>## [1] 22</code></pre>
<p>Lets use the <code>month()</code> function to count how many tests have been conducted in each month since the beginning of the pandemic.</p>
<pre class="r"><code>total_tests %&gt;% 
  group_by(month(test_date, label = TRUE)) %&gt;%
  summarise(month_tests = sum(test_count))</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 7 x 2
##   `month(test_date, label = TRUE)` month_tests
##   &lt;ord&gt;                                  &lt;dbl&gt;
## 1 Mar                                   106256
## 2 Apr                                   147130
## 3 May                                   278052
## 4 Jun                                   388739
## 5 Jul                                   622984
## 6 Aug                                   721733
## 7 Sep                                   210431</code></pre>
<p>It looks like we really stepped up the testing in July and August but the NSW Chief Health Officer is right, September rates are really low. Lets plot that…use label = TRUE to include month names rather than numbers.</p>
<p>Make a new df that summarises the total tests conducted each month.</p>
<pre class="r"><code>month_summary &lt;- total_tests %&gt;% 
  group_by(month(test_date, label = TRUE)) %&gt;%
  summarise(total_tests = sum(test_count)) %&gt;%
  rename(covid_month = &#39;month(test_date, label = TRUE)&#39;)</code></pre>
<div id="plot-total-tests-by-month" class="section level3">
<h3>plot total tests by month</h3>
<pre class="r"><code>month_summary %&gt;%
  ggplot(aes(x = covid_month, y = total_tests, fill = covid_month)) +
  geom_col() +
  scale_fill_hp_d(option = &quot;LunaLovegood&quot;) +
  scale_y_continuous(limits = c(0, 800000), expand = c(0,0)) +
  labs(title = &quot;Total number of COVID tests conducted in NSW \n each month&quot;, x = &quot;Month&quot;, y = &quot;Total tests&quot;, caption = &quot;data downloaded from https://data.nsw.gov.au/nsw-covid-19-data (28-9-2020)&quot;) +
  theme_classic() +
  easy_remove_legend() </code></pre>
<p><img src="/post/2020-09-26-emulate-a-rlady_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>Yikes September total tests are REALLY low, there is still a few days left but still…</p>
<p>The health officials are always talking about variability in the number of new cases might be related to when the tests are conducted. I wonder whether there is a pattern in the number of tests conducted across the week. <code>lubridate</code> has a <code>wday()</code> function that works a lot like <code>month()</code> to allow you to summarise by day of the week.</p>
<p>Make a new df that summarises the mean number of tests conducted each day of the week.</p>
<pre class="r"><code>wday_summary &lt;- total_tests %&gt;% 
  group_by(wday(test_date, label = TRUE)) %&gt;%
  summarise(mean_tests = mean(test_count)) %&gt;%
  rename(covid_day = &#39;wday(test_date, label = TRUE)&#39;)</code></pre>
</div>
<div id="plot-mean-tests-each-week-day" class="section level3">
<h3>plot mean tests each week day</h3>
<pre class="r"><code>wday_summary %&gt;%
  ggplot(aes(x = covid_day, y = mean_tests, fill = covid_day)) +
  geom_col() +
  scale_fill_hp_d(option = &quot;HermioneGranger&quot;) +
  scale_y_continuous(limits = c(0, 20000), expand = c(0,0)) +
  labs(title = &quot;Mean number of COVID tests conducted in NSW \n each weekday&quot;, x = &quot;Week day&quot;, y = &quot;Total tests&quot;, caption = &quot;data downloaded from https://data.nsw.gov.au/nsw-covid-19-data (28-9-2020)&quot;) +
  theme_classic() +
  easy_remove_legend()</code></pre>
<p><img src="/post/2020-09-26-emulate-a-rlady_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>Looks like testing rates decline across the working week, and are definitely much lower in the weekend. I wonder whether that pattern has changed across the pandemic.</p>
<p>Make a new df that summarises the number of tests conducted by day of the week for each month. Use <code>week_start = getOption("lubridate.week.start", 1)</code> to make Monday the start of the week.</p>
<pre class="r"><code>wday_month_summary &lt;- total_tests %&gt;% 
  mutate(covid_day = wday(test_date,  week_start = getOption(&quot;lubridate.week.start&quot;, 1), label = TRUE)) %&gt;%
  mutate(covid_month = month(test_date, label = TRUE)) %&gt;%
  group_by(covid_day, covid_month) %&gt;%
  summarise(mean_tests = mean(test_count, na.rm = TRUE))</code></pre>
</div>
<div id="plot-mean-tests-each-week-day-by-month" class="section level3">
<h3>plot mean tests each week day by month</h3>
<pre class="r"><code>wday_month_summary %&gt;%
  ggplot(aes(x = covid_day, y = mean_tests, fill = covid_day)) +
  geom_col() +
 scale_fill_hp_d(option = &quot;DracoMalfoy&quot;) +
  facet_wrap(~covid_month) +
  scale_y_continuous(limits = c(0, 35000), expand = c(0,0)) +
  labs(title = &quot;Mean number of COVID tests conducted in NSW \n each week day across the pandemic&quot;, 
       x = &quot;Week day&quot;, y = &quot;Total tests&quot;, 
       caption = &quot;data downloaded from https://data.nsw.gov.au/nsw-covid-19-data (28-9-2020)&quot;) +
  easy_remove_legend()</code></pre>
<p><img src="/post/2020-09-26-emulate-a-rlady_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p><code>geom_col()</code> makes it difficult to see how testing rates might have changed across the pandemic. Lets look at just July - September.</p>
</div>
<div id="plot-mean-tests-each-week-day-july---sept" class="section level3">
<h3>plot mean tests each week day July - Sept</h3>
<pre class="r"><code>wday_month_summary %&gt;%
  filter(covid_month %in% c(&quot;Jul&quot;, &quot;Aug&quot;, &quot;Sep&quot;)) %&gt;%
  ggplot(aes(x = covid_day, y = mean_tests, 
             colour = covid_month, group = covid_month)) +
  geom_point(size = 3) +
  geom_line() +
 scale_colour_hp_d(option = &quot;RonWeasley&quot;) +
  scale_y_continuous(limits = c(0, 35000), expand = c(0,0)) +
  labs(title = &quot;Mean number of COVID tests conducted in NSW \n each weekday in the past 3 months&quot;, x = &quot;Week day&quot;, y = &quot;Mean tests&quot;, caption = &quot;data downloaded from https://data.nsw.gov.au/nsw-covid-19-data (28-9-2020)&quot;) +
  theme_classic() +
 theme(
    legend.position = c(.98, .98),
    legend.justification = c(&quot;right&quot;, &quot;top&quot;),
    legend.box.just = &quot;right&quot;,
    legend.margin = margin(6, 6, 6, 6)
    )</code></pre>
<p><img src="/post/2020-09-26-emulate-a-rlady_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>Interesting… looks like testing rates in Sept are the same as in Aug (but lower than July) early in the week, but fewer people are being tested as the week goes on.</p>
</div>
<div id="how-many-fewer-tests-are-we-doing-each-day-in-sept-relative-to-july-levels" class="section level3">
<h3>How many fewer tests are we doing each day in Sept relative to July levels?</h3>
<p>Using the <code>day()</code> function instead of <code>wday()</code> to plot the tests each day across the month.</p>
<pre class="r"><code>total_tests %&gt;% 
  filter(month(test_date, label = TRUE) %in% c(&quot;Jul&quot;, &quot;Aug&quot;, &quot;Sep&quot;)) %&gt;%
  ggplot(aes(x = day(test_date), y = test_count, fill = wday(test_date, label = TRUE, week_start = getOption(&quot;lubridate.week.start&quot;, 1)))) +
  geom_col() +
  facet_wrap(~month(test_date, label = TRUE)) +
  scale_fill_hp_d(option = &quot;LunaLovegood&quot;) +
  scale_y_continuous(limits = c(0, 40000), expand = c(0,0)) +
  labs(title = &quot;Daily COVID tests conducted in NSW in July-Sept&quot;, x = &quot;Month&quot;, y = &quot;Tests per day&quot;, caption = &quot;data downloaded from https://data.nsw.gov.au/nsw-covid-19-data (28-9-2020)&quot;) +
  theme_classic() +
  easy_remove_legend_title()</code></pre>
<p><img src="/post/2020-09-26-emulate-a-rlady_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>Oh!!!</p>
<p>The data I downloaded 28-9-2020 is incomplete. Even though the website says this data is updated every day, the total tests for Sept are bad because we only have data up until 11-9-2020.</p>
</div>
</div>
<div id="what-have-i-learned-about-lubridate-thus-far" class="section level1">
<h1>What have I learned about lubridate thus far</h1>
<ul>
<li>sometimes R automatically recognises your date variables as dates, but I’m not sure why this happens really infrequently with my real world data- probably related to d-m-y format not being the R default
<ul>
<li>how to make it more likely that R will read my dates as dates</li>
<li>how to convert dates that R thinks are characters into date format</li>
</ul></li>
<li>lubridate functions like <code>day()</code>, <code>w_day()</code>, <code>month()</code> and <code>year()</code>, make it easy to work with date components as ordinal factors
<ul>
<li>use <code>label = TRUE</code> when using these functions to use labels rather than numeric values</li>
<li>use <code>week_start = getOption("lubridate.week.start", 1)</code> to change the default from the week starting on Sunday to starting on Monday</li>
</ul></li>
<li>lubridate still clashes with the here package; if you are using both you need to specify <code>here::here()</code>. Find out when lubridate will no longer have a <code>here()</code> function.</li>
</ul>
</div>

         
      </div>
    </div>
  </div>
</div>

          </div>
      </div>
  </div>
  <script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/jquery.cookie.js"> </script>
<script src="/js/ekko-lightbox.js"></script>
<script src="/js/jquery.scrollTo.min.js"></script>
<script src="/js/masonry.pkgd.min.js"></script>
<script src="/js/imagesloaded.pkgd.min.js"></script>
<script src="/js/owl.carousel.min.js"></script>
<script src="/js/front.js"></script>

</body>
</html>
